<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Composable State Space Models</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Bayesian Inference for Composable State Space Models" /><meta name="author" content="com.github.jonnylaw" /><meta name="og:image" content="/ComposableStateSpaceModels/img/poster.png" /><meta name="og:title" content="Composable State Space Models" /><meta name="og:site_name" content="Composable State Space Models" /><meta name="og:url" content="" /><meta name="og:type" content="website" /><meta name="og:description" content="Bayesian Inference for Composable State Space Models" /><meta name="twitter:image" content="/ComposableStateSpaceModels/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><meta name="kazari-dependencies" content="" /><meta name="kazari-resolvers" content="" /><link rel="icon" type="image/png" href="/ComposableStateSpaceModels/img/favicon.png" /><link rel="icon" type="image/png" sizes="16x16" href="/ComposableStateSpaceModels/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/ComposableStateSpaceModels/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/ComposableStateSpaceModels/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/ComposableStateSpaceModels/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/ComposableStateSpaceModels/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/ComposableStateSpaceModels/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/ComposableStateSpaceModels/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/ComposableStateSpaceModels/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/ComposableStateSpaceModels/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/ComposableStateSpaceModels/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/ComposableStateSpaceModels/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/ComposableStateSpaceModels/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/ComposableStateSpaceModels/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/ComposableStateSpaceModels/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/ComposableStateSpaceModels/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/ComposableStateSpaceModels/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/ComposableStateSpaceModels/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/ComposableStateSpaceModels/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/ComposableStateSpaceModels/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/ComposableStateSpaceModels/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/ComposableStateSpaceModels/highlight/styles/solarized-dark.css" /><link rel="stylesheet" href="/ComposableStateSpaceModels/css/style.css" /><link rel="stylesheet" href="/ComposableStateSpaceModels/css/palette.css" /><link rel="stylesheet" href="/ComposableStateSpaceModels/css/codemirror.css" /><link rel="stylesheet" href="/ComposableStateSpaceModels/css/kazari-style.css" /><link rel="stylesheet" href="/ComposableStateSpaceModels/css/solarized-dark.css" /><link rel="stylesheet" href="/ComposableStateSpaceModels/css/solarized-dark.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/ComposableStateSpaceModels/" class="brand"><div class="brand-wrapper"><span>Composable State Space Models</span></div></a></li><li><a href="/ComposableStateSpaceModels/docs/forecasting.html" class="">Forecasting</a></li><li><a href="/ComposableStateSpaceModels/docs/" class="">Getting Started</a></li><li><a href="/ComposableStateSpaceModels/" class=""></a></li><li><a href="/ComposableStateSpaceModels/docs/model.html" class=" active ">Models</a></li><li><a href="/ComposableStateSpaceModels/css/palette.css" class=""></a></li><li><a href="/ComposableStateSpaceModels/docs/particle_filter.html" class="">Particle Filter</a></li><li><a href="/ComposableStateSpaceModels/docs/pmmh.html" class=""></a></li><li><a href="/ComposableStateSpaceModels/css/style.css" class=""></a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/jonnylaw/ComposableStateSpaceModels"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/jonnylaw/ComposableStateSpaceModels"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Composable State Space Models Bayesian Inference for Composable State Space Models');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Composable State Space Models Bayesian Inference for Composable State Space Models');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="jonnylaw" data-github-repo="ComposableStateSpaceModels"><div class="content-wrapper"><section><h1 id="composable-state-space-models">Composable State Space Models</h1>

<p>A composable state space model is a parametric probabilistic latent state model used to forecast and interpolate time dependent data. This library provides several latent-state models with a variety of observation and state evolution models, these models can be composed together to build complex models hierarchically. The latent space of the model evolves in continuous time according to a <a href="https://en.wikipedia.org/wiki/Stochastic_differential_equation">stochastic differential equation</a>, this allows us to model data which arrives irregularly, this is common in sensor deployments in the real world, where sensors can sample adaptively, or the server receiving the data can go offline for an undetermined amount of time. The composable state space models provided in this library intend to be flexible enough to model a variety of time dependent data.</p>

<h2 id="a-single-gaussian-model">A Single Gaussian Model</h2>

<p>The latent-state drives a transformation of the mean of the observation distribution, for instance a Gaussian state space model with a Brownian motion latent state would be specified in full as:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align*}
y(t_i) | \eta(t_i) &\sim \mathcal{N}(\eta(t_i), V) \\
\eta(t_i) &= x(t_i) \\
X(t_i) | (X(t_{i-1}) = x(t_{i-1})) &\sim \mathcal{N}(x(t_{i-1}), \sigma \textrm{d}t)
\end{align*} %]]></script>

<p>The mean of the Gaussian observation distribution at time \(t_i\) is \(\eta(t_i\), this is the same as the latent state since the mean of the Gaussian distribution can vary over the entire real line. Hence the linking function is the identity function. The model can be expressed as a DAG:</p>

<p>In order to build this model in Scala using the composable model frame work, we first need to specify the state space. A univariate Brownian motion:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.github.jonnylaw.model._</span>
<span class="k">import</span> <span class="nn">breeze.numerics.log</span>

<span class="k">val</span> <span class="n">m0</span> <span class="k">=</span> <span class="mf">0.0</span>
<span class="k">val</span> <span class="n">c0</span> <span class="k">=</span> <span class="n">log</span><span class="o">(</span><span class="mf">1.0</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sigma</span> <span class="k">=</span> <span class="n">log</span><span class="o">(</span><span class="mf">0.02</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sdeParam</span> <span class="k">=</span> <span class="nc">SdeParameter</span><span class="o">.</span><span class="n">brownianParameter</span><span class="o">(</span><span class="n">m0</span><span class="o">)(</span><span class="n">c0</span><span class="o">)(</span><span class="n">sigma</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sde</span> <span class="k">=</span> <span class="nc">Sde</span><span class="o">.</span><span class="n">brownianMotion</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</code></pre>
</div>

<p>Note that strictly positive parameters are specified on the log-scale. The parameters of Brownian motion include the parameters of the initial state \(x(t_0) \sim \mathcal{N}(m_0, C_0) \) and the value of the diffusion coefficient, \(\sigma\). The function <code class="highlighter-rouge">Sde.brownianMotion</code> accepts an integer which determines how many dimensions the SDE has, in this case it is univariate Brownian motion. The function <code class="highlighter-rouge">brownianParameter</code> is fully curried, this is to allow for variadic parameters, which means the number of parameters is not fixed. For instance a two-dimensional Brownian motion SDE can share the same set of parameters, or can have seperate diffusion parameters.</p>

<p>Now, we must specify the observation variance \(V\), which is required by the Gaussian Model. The variance is an option parameter, and hence represented by a Scala <code class="highlighter-rouge">Option</code>, and is specified on the log scale.</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">gaussianModel</span> <span class="k">=</span> <span class="nc">Model</span><span class="o">.</span><span class="n">linear</span><span class="o">(</span><span class="n">sde</span><span class="o">)</span>
<span class="k">val</span> <span class="n">gaussianParams</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="n">log</span><span class="o">(</span><span class="mf">1.0</span><span class="o">)),</span> <span class="n">sdeParam</span><span class="o">)</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">Model</code> object has many pre-defined models, the Gaussian model is called <code class="highlighter-rouge">linearModel</code> and all models are a function from <code class="highlighter-rouge">Sde =&gt; Parameters =&gt; Model</code>. Hence <code class="highlighter-rouge">model</code> is a function from <code class="highlighter-rouge">Parameters =&gt; Model</code>, once the parameters are supplied to the model we can access the functions belonging to the model:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Model</span> <span class="o">{</span>
  <span class="cm">/**
    * The observation model, a function from eta to a distribution over the observations
    * realisations can be produced from the observation model by calling draw
    */</span>
  <span class="k">def</span> <span class="n">observation</span><span class="k">:</span> <span class="kt">Gamma</span> <span class="o">=&gt;</span> <span class="nc">Rand</span><span class="o">[</span><span class="kt">Observation</span><span class="o">]</span>
  <span class="cm">/**
    * The linking-function, transforms the state space into the parameter space of the 
    * observation distribution using a possibly non-linear transformation
    */</span>
  <span class="k">def</span> <span class="n">link</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Gamma</span><span class="o">)</span><span class="k">:</span> <span class="kt">Eta</span> <span class="o">=</span> <span class="n">x</span>

  <span class="cm">/**
    * The Linear, deterministic transformation function. f is used to add seasonal factors or
    * other time depending linear transformations
    */</span> 
  <span class="k">def</span> <span class="n">f</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">State</span><span class="o">,</span> <span class="n">t</span><span class="k">:</span> <span class="kt">Time</span><span class="o">)</span><span class="k">:</span> <span class="kt">Gamma</span>
  <span class="cm">/**
    * An exact or approximate solution to a diffusion process, used to advance the latent state.
    * This function returns a distribution over the next state and can be simulated from
    */</span>
  <span class="k">def</span> <span class="n">sde</span><span class="k">:</span> <span class="kt">Sde</span>
  <span class="cm">/**
    * The data likelihood, given the linearly transformed latent state, gamma, and an observation
    * the log-likelihood can be calculated for use in inference algorithms
    */</span>
  <span class="k">def</span> <span class="n">dataLikelihood</span><span class="k">:</span> <span class="o">(</span><span class="kt">Gamma</span><span class="o">,</span> <span class="kt">Observation</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">LogLikelihood</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="composing-models">Composing Models</h2>

<p>To create a seasonal Gaussian model with a multivariate Brownian motion latent state, we can compose the model above with a seasonal model. Firstly, letâ€™s specify a seasonal model with a period of 3 and 5 harmonics, this requires a latent state with 10-dimensions:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">sdeMulti</span> <span class="k">=</span> <span class="nc">Sde</span><span class="o">.</span><span class="n">brownianMotion</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="k">val</span> <span class="n">seasonalModel</span> <span class="k">=</span> <span class="nc">Model</span><span class="o">.</span><span class="n">seasonal</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="n">sdeMulti</span><span class="o">)</span>
<span class="k">val</span> <span class="n">seasonalParams</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">(</span><span class="nc">None</span><span class="o">,</span> <span class="n">sdeParam</span><span class="o">)</span>
</code></pre>
</div>

<p>Note that the parameters for each dimension of the Brownian motion are taken to be identical in this case. In order to compose this model, we need to compose both the parameters and the model in a specific order:</p>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.implicits._</span>

<span class="k">val</span> <span class="n">composedParams</span> <span class="k">=</span> <span class="n">gaussianParams</span> <span class="o">|+|</span> <span class="n">seasonalParams</span>
<span class="k">val</span> <span class="n">composedModel</span> <span class="k">=</span> <span class="n">gaussianModel</span> <span class="o">|+|</span> <span class="n">seasonalModel</span>
</code></pre>
</div>

<p>The parameters of the model, and the model, with the desired observation model must be on the left. The parameters form a binary tree, each single model is a <code class="highlighter-rouge">LeafParameter</code> which combines into a <code class="highlighter-rouge">BranchParameter</code>. The state of the model also forms a binary tree. The function <code class="highlighter-rouge">|+|</code> is a closed binary composition function defined on the space of composable models. The composable models form a semigroup.</p>
</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/ComposableStateSpaceModels/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/ComposableStateSpaceModels/js/main.js"></script><script src="/ComposableStateSpaceModels/js/kazari.js"></script><script>
$(document).ready(function() {
	kazari.KazariPlugin().decorateCode('https://scala-evaluator-212.herokuapp.com/eval', 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.S2F6YXJp.Jl2eqMfw8IakJF93PjxTbrf-8YUJgX5OoOfy5JHE8Yw', '', 'solarized-dark')
})
    </script></body></html>